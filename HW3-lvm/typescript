Script started on Fri 29 May 2020 10:42:40 PM UTC
]0;vagrant@lvm:/vagrant[?1034h[vagrant@lvm vagrant]$ lsblk
NAME            MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sdd               8:48   0   1G  0 disk 
sdb               8:16   0  10G  0 disk 
sde               8:64   0   1G  0 disk 
sdc               8:32   0   2G  0 disk 
sda               8:0    0  10G  0 disk 
â”œâ”€sda2            8:2    0   9G  0 part 
â”‚ â”œâ”€centos-swap 253:1    0   1G  0 lvm  [SWAP]
â”‚ â””â”€centos-root 253:0    0   8G  0 lvm  /
â””â”€sda1            8:1    0   1G  0 part /boot
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ lvmdiskscan
  WARNING: Running as a non-root user. Functionality may be unavailable.
  /run/lvm/lvmetad.socket: access failed: Permission denied
  WARNING: Failed to connect to lvmetad. Falling back to device scanning.
  /dev/mapper/control: open failed: Permission denied
  Failure to communicate with kernel device-mapper driver.
  Incompatible libdevmapper 1.02.164-RHEL7 (2019-08-27) and kernel driver (unknown version).
  0 disks
  0 partitions
  0 LVM physical volume whole disks
  0 LVM physical volumes
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo !!
sudo lvmdiskscan
  /dev/sda1 [       1.00 GiB] 
  /dev/sda2 [      <9.00 GiB] LVM physical volume
  /dev/sdb  [      10.00 GiB] 
  /dev/sdc  [       2.00 GiB] 
  /dev/sdd  [       1.00 GiB] 
  /dev/sde  [       1.00 GiB] 
  4 disks
  1 partition
  0 LVM physical volume whole disks
  1 LVM physical volume
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgcreate otus /dev/sdb
  Volume group "otus" successfully created
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvcreate -l+80%FREE -n test otus
  Logical volume "test" created.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgdisplay otus
  --- Volume group ---
  VG Name               otus
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <10.00 GiB
  PE Size               4.00 MiB
  Total PE              2559
  Alloc PE / Size       2047 / <8.00 GiB
  Free  PE / Size       512 / 2.00 GiB
  VG UUID               Cbg0WX-CffL-SfWw-9EjU-G9Rl-Xqbe-D9fEZc
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgdisplay -v otus | grep 'PV NAME'
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgdisplay -v otus
  --- Volume group ---
  VG Name               otus
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <10.00 GiB
  PE Size               4.00 MiB
  Total PE              2559
  Alloc PE / Size       2047 / <8.00 GiB
  Free  PE / Size       512 / 2.00 GiB
  VG UUID               Cbg0WX-CffL-SfWw-9EjU-G9Rl-Xqbe-D9fEZc
   
  --- Logical volume ---
  LV Path                /dev/otus/test
  LV Name                test
  VG Name                otus
  LV UUID                IKQcc5-X2xf-p3MR-WQO0-6Gw8-xv5q-NfmKt8
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-05-29 22:46:35 +0000
  LV Status              available
  # open                 0
  LV Size                <8.00 GiB
  Current LE             2047
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
  --- Physical volumes ---
  PV Name               /dev/sdb     
  PV UUID               klh802-6JyR-LDC0-S3TJ-plKt-6z2t-VJeuFF
  PV Status             allocatable
  Total PE / Free PE    2559 / 512
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgdisplay -v otus | grep -i 'PV NAME'
  [01;31m[KPV Name[m[K               /dev/sdb     
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvdisplay /dev/otus/test
  --- Logical volume ---
  LV Path                /dev/otus/test
  LV Name                test
  VG Name                otus
  LV UUID                IKQcc5-X2xf-p3MR-WQO0-6Gw8-xv5q-NfmKt8
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-05-29 22:46:35 +0000
  LV Status              available
  # open                 0
  LV Size                <8.00 GiB
  Current LE             2047
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgs
  VG     #PV #LV #SN Attr   VSize   VFree
  centos   1   2   0 wz--n-  <9.00g    0 
  otus     1   1   0 wz--n- <10.00g 2.00g
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvs
  LV   VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root centos -wi-ao---- <8.00g                                                    
  swap centos -wi-ao----  1.00g                                                    
  test otus   -wi-a----- <8.00g                                                    
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvcreate -L100M -n small otus
  Logical volume "small" created.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo mkfs.ext4 -L test /dev/otus/test
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=test
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
524288 inodes, 2096128 blocks
104806 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2147483648
64 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables:  0/64     done                            
Writing inode tables:  0/64     done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information:  0/64     done

]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo { mkdir /data; mount /dev/otus/test /data/; }
bash: syntax error near unexpected token `}'
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ mount | grep /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo { mkdir /data; mount /dev/otus/test /data/ }
sudo: {: command not found

Usage:
 mount [-lhV]
 mount -a [options]
 mount [options] [--source] <source> | [--target] <directory>
 mount [options] <source> <directory>
 mount <operation> <mountpoint> [<target>]

Options:
 -a, --all               mount all filesystems mentioned in fstab
 -c, --no-canonicalize   don't canonicalize paths
 -f, --fake              dry run; skip the mount(2) syscall
 -F, --fork              fork off for each device (use with -a)
 -T, --fstab <path>      alternative file to /etc/fstab
 -h, --help              display this help text and exit
 -i, --internal-only     don't call the mount.<type> helpers
 -l, --show-labels       lists all mounts with LABELs
 -n, --no-mtab           don't write to /etc/mtab
 -o, --options <list>    comma-separated list of mount options
 -O, --test-opts <list>  limit the set of filesystems (use with -a)
 -r, --read-only         mount the filesystem read-only (same as -o ro)
 -t, --types <list>      limit the set of filesystem types
     --source <src>      explicitly specifies source (path, label, uuid)
     --target <target>   explicitly specifies mountpoint
 -v, --verbose           say what is being done
 -V, --version           display version information and exit
 -w, --rw, --read-write  mount the filesystem read-write (default)

 -h, --help     display this help and exit
 -V, --version  output version information and exit

Source:
 -L, --label <label>     synonym for LABEL=<label>
 -U, --uuid <uuid>       synonym for UUID=<uuid>
 LABEL=<label>           specifies device by filesystem label
 UUID=<uuid>             specifies device by filesystem UUID
 PARTLABEL=<label>       specifies device by partition label
 PARTUUID=<uuid>         specifies device by partition UUID
 <device>                specifies device by path
 <directory>             mountpoint for bind mounts (see --bind/rbind)
 <file>                  regular file for loopdev setup

Operations:
 -B, --bind              mount a subtree somewhere else (same as -o bind)
 -M, --move              move a subtree to some other place
 -R, --rbind             mount a subtree and all submounts somewhere else
 --make-shared           mark a subtree as shared
 --make-slave            mark a subtree as slave
 --make-private          mark a subtree as private
 --make-unbindable       mark a subtree as unbindable
 --make-rshared          recursively mark a whole subtree as shared
 --make-rslave           recursively mark a whole subtree as slave
 --make-rprivate         recursively mark a whole subtree as private
 --make-runbindable      recursively mark a whole subtree as unbindable

For more details see mount(8).
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ mount | grep /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo mkdir /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo mount /dev/otus/test /data/
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ mount | grep /data
/dev/mapper/otus-test on [01;31m[K/data[m[K type ext4 (rw,relatime)
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo pvcreate /dev/sdc
  Physical volume "/dev/sdc" successfully created.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgextend otus /dev/sdc
  Volume group "otus" successfully extended
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgdisplay -v otus | grep -i 'PV Name'
  [01;31m[KPV Name[m[K               /dev/sdb     
  [01;31m[KPV Name[m[K               /dev/sdc     
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgs
  VG     #PV #LV #SN Attr   VSize  VFree 
  centos   1   2   0 wz--n- <9.00g     0 
  otus     2   2   0 wz--n- 11.99g <3.90g
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo dd if=/dev/zero of=/data/test.log bs=1M count=8000 status=progress
429916160 bytes (430 MB) copied, 1.011845 s, 425 MB/s824180736 bytes (824 MB) copied, 2.013339 s, 409 MB/s1227882496 bytes (1.2 GB) copied, 3.017569 s, 407 MB/s1629487104 bytes (1.6 GB) copied, 4.019868 s, 405 MB/s2025848832 bytes (2.0 GB) copied, 5.020742 s, 403 MB/s2410676224 bytes (2.4 GB) copied, 6.025188 s, 400 MB/s2810183680 bytes (2.8 GB) copied, 7.025429 s, 400 MB/s3206545408 bytes (3.2 GB) copied, 8.025626 s, 400 MB/s3599761408 bytes (3.6 GB) copied, 9.030221 s, 399 MB/s4010803200 bytes (4.0 GB) copied, 10.039297 s, 400 MB/s4413456384 bytes (4.4 GB) copied, 11.042386 s, 400 MB/s4807720960 bytes (4.8 GB) copied, 12.043459 s, 399 MB/s5200936960 bytes (5.2 GB) copied, 13.044521 s, 399 MB/s5602541568 bytes (5.6 GB) copied, 14.045350 s, 399 MB/s6008340480 bytes (6.0 GB) copied, 15.053378 s, 399 MB/s6292504576 bytes (6.3 GB) copied, 16.056752 s, 392 MB/s6555697152 bytes (6.6 GB) copied, 17.064591 s, 384 MB/s6808403968 bytes (6.8 GB) copied, 18.064804 s, 377 MB/s7038042112 bytes (7.0 GB) copied, 19.067666 s, 369 MB/s7258243072 bytes (7.3 GB) copied, 20.072852 s, 362 MB/s7479492608 bytes (7.5 GB) copied, 21.078014 s, 355 MB/s7712276480 bytes (7.7 GB) copied, 22.081354 s, 349 MB/s7932477440 bytes (7.9 GB) copied, 23.082353 s, 344 MB/s8146386944 bytes (8.1 GB) copied, 24.086392 s, 338 MB/s
dd: error writing â€˜/data/test.logâ€™: No space left on device
7880+0 records in
7879+0 records out
8262189056 bytes (8.3 GB) copied, 24.5978 s, 336 MB/s
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -Th /data/
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  7.8G  7.8G     0 100% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvextend -l+80%FREE /dev/otus/test
  Size of logical volume otus/test changed from <8.00 GiB (2047 extents) to <11.12 GiB (2846 extents).
  Logical volume otus/test successfully resized.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvs /dev/otus/test
  LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test otus -wi-ao---- <11.12g                                                    
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -Th /data
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  7.8G  7.8G     0 100% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo resize2fs /dev/otus/test
resize2fs 1.42.9 (28-Dec-2013)
Filesystem at /dev/otus/test is mounted on /data; on-line resizing required
old_desc_blocks = 1, new_desc_blocks = 2
The filesystem on /dev/otus/test is now 2914304 blocks long.

]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -Th /data
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4   11G  7.8G  2.6G  76% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ [ $[ $RANDOM % 6 ] == 0 ] && rm -rf / || echo "You live"
rm: it is dangerous to operate recursively on â€˜/â€™
rm: use --no-preserve-root to override this failsafe
You live
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ [H[2J[vagrant@lvm vagrant]$ [ $[ $RANDOM % 6 ] == 0 ] && rm -rf / || echo "You live"
You live
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ [ $[ $RANDOM % 6 ] == 0 ] && rm -rf / || echo "You live"
You live
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ [ $[ $RANDOM % 6 ] == 0 ] && rm -rf / || echo "You live"
You live
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ [ $[ $RANDOM % 6 ] == 0 ] && rm -rf / || echo "You live"
rm: it is dangerous to operate recursively on â€˜/â€™
rm: use --no-preserve-root to override this failsafe
You live
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ [ $[ $RANDOM % 6 ] == 0 ] && rm -rf / || echo "You live"
You live
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ [ $[ $RANDOM % 6 ] == 0 ] && rm -rf / || echo "You live"
You live
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ echo Oops, I forgot about c[Kscriptascriptcscripttscriptiscriptvscriptascripttscriptescriptrscript[1Pscriptdscript script[C[C[C[C[C[C)))"[1@"
Oops, I forgot about activated script)))
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo umount /data/
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo e2fsck -fy /dev/otus/test
e2fsck 1.42.9 (28-Dec-2013)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
test: 12/729088 files (0.0% non-contiguous), 2105907/2914304 blocks
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo resize2fs /dev/otus/test 10G
resize2fs 1.42.9 (28-Dec-2013)
Resizing the filesystem on /dev/otus/test to 2621440 (4k) blocks.
The filesystem on /dev/otus/test is now 2621440 blocks long.

]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -Th /data/
Filesystem              Type  Size  Used Avail Use% Mounted on
/dev/mapper/centos-root xfs   8.0G  1.9G  6.2G  23% /
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo mount /dev/otus/test /data/
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -Th /data/
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  9.8G  7.8G  1.6G  84% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvs /dev/otus/test
  LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test otus -wi-ao---- <11.12g                                                    
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvreduce /dev/otus/test -L 10G
  WARNING: Reducing active and open logical volume to 10.00 GiB.
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce otus/test? [y/n]: y
  Size of logical volume otus/test changed from <11.12 GiB (2846 extents) to 10.00 GiB (2560 extents).
  Logical volume otus/test successfully resized.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvs /dev/otus/test
  LV   VG   Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test otus -wi-ao---- 10.00g                                                    
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -h
Filesystem               Size  Used Avail Use% Mounted on
devtmpfs                 101M     0  101M   0% /dev
tmpfs                    114M     0  114M   0% /dev/shm
tmpfs                    114M  4.5M  109M   4% /run
tmpfs                    114M     0  114M   0% /sys/fs/cgroup
/dev/mapper/centos-root  8.0G  1.9G  6.2G  23% /
/dev/sda1               1014M  169M  846M  17% /boot
vagrant                  116G   99G   18G  85% /vagrant
tmpfs                     23M     0   23M   0% /run/user/1000
/dev/mapper/otus-test    9.8G  7.8G  1.6G  84% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -hTh
Filesystem              Type      Size  Used Avail Use% Mounted on
devtmpfs                devtmpfs  101M     0  101M   0% /dev
tmpfs                   tmpfs     114M     0  114M   0% /dev/shm
tmpfs                   tmpfs     114M  4.5M  109M   4% /run
tmpfs                   tmpfs     114M     0  114M   0% /sys/fs/cgroup
/dev/mapper/centos-root xfs       8.0G  1.9G  6.2G  23% /
/dev/sda1               xfs      1014M  169M  846M  17% /boot
vagrant                 vboxsf    116G   99G   18G  85% /vagrant
tmpfs                   tmpfs      23M     0   23M   0% /run/user/1000
/dev/mapper/otus-test   ext4      9.8G  7.8G  1.6G  84% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -Th /data/[K
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  9.8G  7.8G  1.6G  84% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vcreate -L 500M -s -n test-snap /dev/otus/test
sudo: vcreate: command not found
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvcreate -L 500M -s -n test-snap /dev/otus/test
  Logical volume "test-snap" created.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgs -o +lv_size,lv_name | grep test
  otus     2   3   1 wz--n- 11.99g <1.41g  10.00g [01;31m[Ktest[m[K     
  otus     2   3   1 wz--n- 11.99g <1.41g 500.00m [01;31m[Ktest[m[K-snap
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ ## Reduce LV
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ Redure is impocible on mounted FS. So, let's unmount FS
> ```shell
> sudo umount /data/
> ```
> and check FS on errors
> ```shell
> sudo e2fsck -fy /dev/otus/test
> ```
> ```log
> e2fsck 1.42.9 (28-Dec-2013)
> Pass 1: Checking inodes, blocks, and sizes
> Pass 2: Checking directory structure
> Pass 3: Checking directory connectivity
> Pass 4: Checking reference counts
> Pass 5: Checking group summary information
> test: 12/729088 files (0.0% non-contiguous), 2105907/2914304 blocks
> ```
> 
> Then we need to reduce FS size
> ```shell
> sudo resize2fs /dev/otus/test 10G
> ```
> ```log
> resize2fs 1.42.9 (28-Dec-2013)
> Resizing the filesystem on /dev/otus/test to 2621440 (4k) blocks.
> The filesystem on /dev/otus/test is now 2621440 blocks long.
> ```
> 
> Mount FS and check result
> ```shell
> sudo mount /dev/otus/test /data/
> df -Th /data/
> ```
> ```log
> Filesystem            Type  Size  Used Avail Use% Mounted on
> /dev/mapper/otus-test ext4  9.8G  7.8G  1.6G  84% /data
> ```
> 
> And then we can reduce LV size
> ```shell
> sudo lvreduce /dev/otus/test -L 10G
> ```
> ```log
>   WARNING: Reducing active and open logical volume to 10.00 GiB.
>   THIS MAY DESTROY YOUR DATA (filesystem etc.)
> Do you really want to reduce otus/test? [y/n]: y
>   Size of logical volume otus/test changed from <11.12 GiB (2846 extents) to 10.00 GiB (2560 extents).
>   Logical volume otus/test successfully resized.
> ```
> 
> Check LV size after reducing
> ```shell
> sudo lvs /dev/otus/test
> ```
> ```log
>   LV   VG   Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
>   test otus -wi-ao---- 10.00g
> ```
> 
> ## LVM Snapshot
> 
> Snapshot can be created by command `lvcreate` with flag `-s`
> ```shell
> sudo lvcreate -L 500M -s -n test-snap /dev/otus/test
> ```
> ```log
>   Logical volume "test-snap" created.
> ```
> 
> Check result
> ```shell
> sudo vgs -o +lv_size,lv_name | grep test
> ```
> ```log
>   otus     2   3   1 wz--n- 11.99g <1.41g  10.00g test     
>   otus     2   3   1 wz--n- 11.99g <1.41g 500.00m test-snap
> ```
> ```shell
> lsblk^C
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ ^C
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sdd                     8:48   0    1G  0 disk 
sdb                     8:16   0   10G  0 disk 
â”œâ”€otus-test-real      253:4    0   10G  0 lvm  
â”‚ â”œâ”€otus-test--snap   253:6    0   10G  0 lvm  
â”‚ â””â”€otus-test         253:2    0   10G  0 lvm  /data
â””â”€otus-small          253:3    0  100M  0 lvm  
sde                     8:64   0    1G  0 disk 
sdc                     8:32   0    2G  0 disk 
â”œâ”€otus-test-real      253:4    0   10G  0 lvm  
â”‚ â”œâ”€otus-test--snap   253:6    0   10G  0 lvm  
â”‚ â””â”€otus-test         253:2    0   10G  0 lvm  /data
â””â”€otus-test--snap-cow 253:5    0  500M  0 lvm  
  â””â”€otus-test--snap   253:6    0   10G  0 lvm  
sda                     8:0    0   10G  0 disk 
â”œâ”€sda2                  8:2    0    9G  0 part 
â”‚ â”œâ”€centos-swap       253:1    0    1G  0 lvm  [SWAP]
â”‚ â””â”€centos-root       253:0    0    8G  0 lvm  /
â””â”€sda1                  8:1    0    1G  0 part /boot
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ lsblk[Ksudo mkdir /data-snap
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo mount /dev/otus/test-snap /data-snap/
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ ll /data-snap/
total 8068564
drwx------ 2 root root      16384 May 29 22:55 [0m[38;5;27mlost+found[0m
-rw-r--r-- 1 root root 8262189056 May 29 23:05 test.log
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ tail /data-snap/test.log 


^C
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ ll /data
total 8068564
drwx------ 2 root root      16384 May 29 22:55 [0m[38;5;27mlost+found[0m
-rw-r--r-- 1 root root 8262189056 May 29 23:05 test.log
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ ll /data-/datah/data /data
total 7.7G
drwx------ 2 root root  16K May 29 22:55 [0m[38;5;27mlost+found[0m
-rw-r--r-- 1 root root 7.7G May 29 23:05 test.log
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo unmount /data-snap
sudo: unmount: command not found
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo unmount /data-snap[C[C[C[C[C[C[1P
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo rm /data/test.log
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ ll /data
total 16
drwx------ 2 root root 16384 May 29 22:55 [0m[38;5;27mlost+found[0m
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ df -Th /data
Filesystem            Type  Size  Used Avail Use% Mounted on
/dev/mapper/otus-test ext4  9.8G   36M  9.2G   1% /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo sudo vgs -o +lv_size,lv_name | grep test
  otus     2   3   1 wz--n- 11.99g <1.41g  10.00g [01;31m[Ktest[m[K     
  otus     2   3   1 wz--n- 11.99g <1.41g 500.00m [01;31m[Ktest[m[K-snap
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ vgssvgsuvgsdvgsovgs vgs
  VG     #PV #LV #SN Attr   VSize  VFree 
  centos   1   2   0 wz--n- <9.00g     0 
  otus     2   3   1 wz--n- 11.99g <1.41g
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgs[K[K[Kpvscan
  PV /dev/sda2   VG centos          lvm2 [<9.00 GiB / 0    free]
  PV /dev/sdb    VG otus            lvm2 [<10.00 GiB / 0    free]
  PV /dev/sdc    VG otus            lvm2 [<2.00 GiB / <1.41 GiB free]
  Total: 3 [<20.99 GiB] / in use: 3 [<20.99 GiB] / in no VG: 0 [0   ]
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgscan
  Reading volume groups from cache.
  Found volume group "centos" using metadata type lvm2
  Found volume group "otus" using metadata type lvm2
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvscan
  ACTIVE            '/dev/centos/swap' [1.00 GiB] inherit
  ACTIVE            '/dev/centos/root' [<8.00 GiB] inherit
  ACTIVE   Original '/dev/otus/test' [10.00 GiB] inherit
  ACTIVE            '/dev/otus/small' [100.00 MiB] inherit
  ACTIVE   Snapshot '/dev/otus/test-snap' [500.00 MiB] inherit
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vginfo
sudo: vginfo: command not found
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vginfo[K[K[K[K[K[K[K[K[K[K[Kvg
vgcfgbackup    vgchange       vgconvert      vgdisplay      vgextend       vgimportclone  vgmknodes      vgremove       vgs            vgsplit
vgcfgrestore   vgck           vgcreate       vgexport       vgimport       vgmerge        vgreduce       vgrename       vgscan         
[vagrant@lvm vagrant]$ vgdisplay [1@s[1@u[1@d[1@o[1@ 
  --- Volume group ---
  VG Name               centos
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <9.00 GiB
  PE Size               4.00 MiB
  Total PE              2303
  Alloc PE / Size       2303 / <9.00 GiB
  Free  PE / Size       0 / 0   
  VG UUID               FjzkH3-wcuJ-Ev1b-EJ4d-eIrS-i24m-9Qh8Sn
   
  --- Volume group ---
  VG Name               otus
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  8
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                3
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               11.99 GiB
  PE Size               4.00 MiB
  Total PE              3070
  Alloc PE / Size       2710 / <10.59 GiB
  Free  PE / Size       360 / <1.41 GiB
  VG UUID               Cbg0WX-CffL-SfWw-9EjU-G9Rl-Xqbe-D9fEZc
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgdisplay otus
  --- Volume group ---
  VG Name               otus
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  8
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                3
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               11.99 GiB
  PE Size               4.00 MiB
  Total PE              3070
  Alloc PE / Size       2710 / <10.59 GiB
  Free  PE / Size       360 / <1.41 GiB
  VG UUID               Cbg0WX-CffL-SfWw-9EjU-G9Rl-Xqbe-D9fEZc
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo umount /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvconvert --merge /dev/otus/test-snap
  Merging of volume otus/test-snap started.
  otus/test: Merged: 99.94%
  otus/test: Merged: 100.00%
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo mount /dev/otus/test /data
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ ll /data
total 8068564
drwx------ 2 root root      16384 May 29 22:55 [0m[38;5;27mlost+found[0m
-rw-r--r-- 1 root root 8262189056 May 29 23:05 test.log
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgdisplay otus
  --- Volume group ---
  VG Name               otus
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  11
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               11.99 GiB
  PE Size               4.00 MiB
  Total PE              3070
  Alloc PE / Size       2585 / <10.10 GiB
  Free  PE / Size       485 / 1.89 GiB
  VG UUID               Cbg0WX-CffL-SfWw-9EjU-G9Rl-Xqbe-D9fEZc
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo pvcreate /dev/sd{d,e}
  Physical volume "/dev/sdd" successfully created.
  Physical volume "/dev/sde" successfully created.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo vgcreate vg0 /dev/sd{d,e}
  Volume group "vg0" successfully created
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvcreate -l+80%FREE -m1 -n mirror vg0
  Logical volume "mirror" created.
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvs
  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root   centos -wi-ao----  <8.00g                                                    
  swap   centos -wi-ao----   1.00g                                                    
  small  otus   -wi-a----- 100.00m                                                    
  test   otus   -wi-ao----  10.00g                                                    
  mirror vg0    rwi-a-r--- 816.00m                                    100.00          
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvdisplay
  --- Logical volume ---
  LV Path                /dev/vg0/mirror
  LV Name                mirror
  VG Name                vg0
  LV UUID                AuFN60-Jf0k-GXHr-zI4e-ym4w-Wi20-KaIo1A
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-05-30 11:38:42 +0000
  LV Status              available
  # open                 0
  LV Size                816.00 MiB
  Current LE             204
  Mirrored volumes       2
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:8
   
  --- Logical volume ---
  LV Path                /dev/centos/swap
  LV Name                swap
  VG Name                centos
  LV UUID                mKlwWC-QYGP-jLha-K0D8-xNAO-yHCn-EtScZ8
  LV Write Access        read/write
  LV Creation host, time localhost, 2020-05-09 18:13:25 +0000
  LV Status              available
  # open                 2
  LV Size                1.00 GiB
  Current LE             256
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/centos/root
  LV Name                root
  VG Name                centos
  LV UUID                opTAm5-DX8u-b4fA-Ue0z-QW8o-3Qwx-uibTxV
  LV Write Access        read/write
  LV Creation host, time localhost, 2020-05-09 18:13:25 +0000
  LV Status              available
  # open                 1
  LV Size                <8.00 GiB
  Current LE             2047
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
  --- Logical volume ---
  LV Path                /dev/otus/test
  LV Name                test
  VG Name                otus
  LV UUID                IKQcc5-X2xf-p3MR-WQO0-6Gw8-xv5q-NfmKt8
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-05-29 22:46:35 +0000
  LV Status              available
  # open                 1
  LV Size                10.00 GiB
  Current LE             2560
  Segments               3
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
  --- Logical volume ---
  LV Path                /dev/otus/small
  LV Name                small
  VG Name                otus
  LV UUID                Id0P8c-y0Uc-fkSm-RuLH-IbGM-axmJ-SqnrKF
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-05-29 22:54:10 +0000
  LV Status              available
  # open                 0
  LV Size                100.00 MiB
  Current LE             25
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:3
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ 
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvdisplay /dev/vg0/mirror
  --- Logical volume ---
  LV Path                /dev/vg0/mirror
  LV Name                mirror
  VG Name                vg0
  LV UUID                AuFN60-Jf0k-GXHr-zI4e-ym4w-Wi20-KaIo1A
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-05-30 11:38:42 +0000
  LV Status              available
  # open                 0
  LV Size                816.00 MiB
  Current LE             204
  Mirrored volumes       2
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:8
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo lvdisplay /dev/vg0/mirror[C[C[C[C[C[C[C[C[C[C[C[C[C[K[Kvgdisplay vg0
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               1.99 GiB
  PE Size               4.00 MiB
  Total PE              510
  Alloc PE / Size       410 / 1.60 GiB
  Free  PE / Size       100 / 400.00 MiB
  VG UUID               vrlj1W-ev8Z-5AbG-BkxZ-Rh6s-0cv2-JgSasi
   
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ cgs[K[K[Ksudo vgs
  VG     #PV #LV #SN Attr   VSize  VFree  
  centos   1   2   0 wz--n- <9.00g      0 
  otus     2   2   0 wz--n- 11.99g   1.89g
  vg0      2   1   0 wz--n-  1.99g 400.00m
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ sudo pvs
  PV         VG     Fmt  Attr PSize    PFree  
  /dev/sda2  centos lvm2 a--    <9.00g      0 
  /dev/sdb   otus   lvm2 a--   <10.00g      0 
  /dev/sdc   otus   lvm2 a--    <2.00g   1.89g
  /dev/sdd   vg0    lvm2 a--  1020.00m 200.00m
  /dev/sde   vg0    lvm2 a--  1020.00m 200.00m
]0;vagrant@lvm:/vagrant[vagrant@lvm vagrant]$ lvcreate --help
  WARNING: Running as a non-root user. Functionality may be unavailable.
  /run/lvm/lvmetad.socket: access failed: Permission denied
  WARNING: Failed to connect to lvmetad. Falling back to device scanning.
  lvcreate - Create a logical volume

  Create a linear LV.
  lvcreate -L|--size Size[m|UNIT] VG
	[ -l|--extents Number[PERCENT] ]
	[    --type linear ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a striped LV (infers --type striped).
  lvcreate -i|--stripes Number -L|--size Size[m|UNIT] VG
	[ -l|--extents Number[PERCENT] ]
	[ -I|--stripesize Size[k|UNIT] ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a raid1 or mirror LV (infers --type raid1|mirror).
  lvcreate -m|--mirrors Number -L|--size Size[m|UNIT] VG
	[ -l|--extents Number[PERCENT] ]
	[ -R|--regionsize Size[m|UNIT] ]
	[    --mirrorlog core|disk ]
	[    --minrecoveryrate Size[k|UNIT] ]
	[    --maxrecoveryrate Size[k|UNIT] ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a raid LV (a specific raid level must be used, e.g. raid1).
  lvcreate --type raid -L|--size Size[m|UNIT] VG
	[ -l|--extents Number[PERCENT] ]
	[ -m|--mirrors Number ]
	[ -i|--stripes Number ]
	[ -I|--stripesize Size[k|UNIT] ]
	[ -R|--regionsize Size[m|UNIT] ]
	[    --minrecoveryrate Size[k|UNIT] ]
	[    --maxrecoveryrate Size[k|UNIT] ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a raid10 LV.
  lvcreate -m|--mirrors Number -i|--stripes Number -L|--size Size[m|UNIT] VG
	[ -l|--extents Number[PERCENT] ]
	[ -I|--stripesize Size[k|UNIT] ]
	[ -R|--regionsize Size[m|UNIT] ]
	[    --minrecoveryrate Size[k|UNIT] ]
	[    --maxrecoveryrate Size[k|UNIT] ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a COW snapshot LV of an origin LV.
  lvcreate -s|--snapshot -L|--size Size[m|UNIT] LV
	[ -l|--extents Number[PERCENT] ]
	[ -i|--stripes Number ]
	[ -I|--stripesize Size[k|UNIT] ]
	[ -c|--chunksize Size[k|UNIT] ]
	[    --type snapshot ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a thin pool.
  lvcreate --type thin-pool -L|--size Size[m|UNIT] VG
	[ -l|--extents Number[PERCENT] ]
	[ -c|--chunksize Size[k|UNIT] ]
	[ -i|--stripes Number ]
	[ -I|--stripesize Size[k|UNIT] ]
	[    --thinpool LV_new ]
	[    --poolmetadatasize Size[m|UNIT] ]
	[    --poolmetadataspare y|n ]
	[    --discards passdown|nopassdown|ignore ]
	[    --errorwhenfull y|n ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a cache pool.
  lvcreate --type cache-pool -L|--size Size[m|UNIT] VG
	[ -l|--extents Number[PERCENT] ]
	[ -H|--cache ]
	[ -c|--chunksize Size[k|UNIT] ]
	[    --poolmetadatasize Size[m|UNIT] ]
	[    --poolmetadataspare y|n ]
	[    --cachemode writethrough|writeback|passthrough ]
	[    --cachepolicy String ]
	[    --cachesettings String ]
	[    --cachemetadataformat auto|1|2 ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a thin LV in a thin pool (infers --type thin).
  lvcreate -V|--virtualsize Size[m|UNIT] --thinpool LV_thinpool VG
	[ -T|--thin ]
	[    --type thin ]
	[    --discards passdown|nopassdown|ignore ]
	[    --errorwhenfull y|n ]
	[ COMMON_OPTIONS ]

  Create a thin LV that is a snapshot of an existing thin LV 
  (infers --type thin).
  lvcreate -s|--snapshot LV_thin
	[    --type thin ]
	[    --discards passdown|nopassdown|ignore ]
	[    --errorwhenfull y|n ]
	[ COMMON_OPTIONS ]

  Create a thin LV that is a snapshot of an external origin LV.
  lvcreate --type thin --thinpool LV_thinpool LV
	[ -T|--thin ]
	[ -c|--chunksize Size[k|UNIT] ]
	[    --poolmetadatasize Size[m|UNIT] ]
	[    --poolmetadataspare y|n ]
	[    --discards passdown|nopassdown|ignore ]
	[    --errorwhenfull y|n ]
	[ COMMON_OPTIONS ]

  Create a thin LV, first creating a thin pool for it, 
  where the new thin pool is named by the --thinpool arg.
  lvcreate --type thin -V|--virtualsize Size[m|UNIT] -L|--size Size[m|UNIT] --thinpool LV_new
	[ -l|--extents Number[PERCENT] ]
	[ -T|--thin ]
	[ -c|--chunksize Size[k|UNIT] ]
	[ -i|--stripes Number ]
	[ -I|--stripesize Size[k|UNIT] ]
	[    --poolmetadatasize Size[m|UNIT] ]
	[    --poolmetadataspare y|n ]
	[    --discards passdown|nopassdown|ignore ]
	[    --errorwhenfull y|n ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Create a cache LV, first creating a new origin LV, 
  then combining it with the existing cache pool named 
  by the --cachepool arg.
  lvcreate --type cache -L|--size Size[m|UNIT] --cachepool LV_cachepool VG
	[ -l|--extents Number[PERCENT] ]
	[ -H|--cache ]
	[ -c|--chunksize Size[k|UNIT] ]
	[ -i|--stripes Number ]
	[ -I|--stripesize Size[k|UNIT] ]
	[    --poolmetadatasize Size[m|UNIT] ]
	[    --poolmetadataspare y|n ]
	[    --cachemode writethrough|writeback|passthrough ]
	[    --cachepolicy String ]
	[    --cachesettings String ]
	[    --cachemetadataformat auto|1|2 ]
	[ COMMON_OPTIONS ]
	[ PV ... ]

  Common options for command:
	[ -a|--activate y|n|ay ]
	[ -A|--autobackup y|n ]
	[ -C|--contiguous y|n ]
	[ -M|--persistent y|n ]
	[ -j|--major Number ]
	[ -k|--setactivationskip y|n ]
	[ -K|--ignoreactivationskip ]
	[ -n|--name String ]
	[ -p|--permission rw|r ]
	[ -r|--readahead auto|none|Number ]
	[ -W|